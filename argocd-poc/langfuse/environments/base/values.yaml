# Langfuse Helm Base Values (Shared across all environments)
# Environment-specific values are injected via ApplicationSet parameters from versions.json
#
# Values overridden by ApplicationSet:
#   - langfuse.nextauth.url
#   - langfuse.ingress.hosts[*]
#   - langfuse.ingress.ingressClassName
#   - langfuse.ingress.tls.secretName
#   - langfuse.web.replicas
#   - langfuse.worker.replicas
#   - postgresql.primary.persistence.size
#   - clickhouse.persistence.size
#   - redis.master.persistence.size
#   - minio.persistence.size

langfuse:
  # Limit old ReplicaSets kept for rollback (default is 10)
  web:
    revisionHistoryLimit: 2
  worker:
    revisionHistoryLimit: 2

  salt:
    secretKeyRef:
      name: langfuse-general
      key: salt
  nextauth:
    # url: injected via parameters
    secret:
      secretKeyRef:
        name: langfuse-nextauth-secret
        key: nextauth-secret
  encryptionKey:
    secretKeyRef:
      name: langfuse-encryption
      key: encryption-key

  ingress:
    enabled: true
    # ingressClassName: injected via parameters
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
      cert-manager.io/cluster-issuer: typeface
    # hosts: injected via parameters
    tls:
      enabled: true
      # secretName: injected via parameters

  features:
    telemetryEnabled: false
    signUpDisabled: false

  additionalEnv:
    - name: LANGFUSE_MAX_EVENT_SIZE_BYTES
      value: "10000000"
    - name: LANGFUSE_MAX_BATCH_SIZE_BYTES
      value: "10000000"
    - name: LANGFUSE_CSP_ENFORCE_HTTPS
      value: "true"
    - name: AUTH_SESSION_MAX_AGE
      value: "1440"
    # Username/password auth enabled (Azure AD disabled)

# Bundled PostgreSQL (deployed as part of the Helm release)
postgresql:
  deploy: true
  architecture: standalone
  auth:
    username: "langfuse"
    password: ""  # Set via existingSecret
    database: "langfuse"
    existingSecret: langfuse-postgresql-auth
    secretKeys:
      adminPasswordKey: postgres-password
      userPasswordKey: password
  primary:
    persistence:
      enabled: true
      # size: injected via parameters
      storageClass: ""  # Use default storage class
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 500m
  migration:
    autoMigrate: true

# Bundled ClickHouse (deployed as part of the Helm release)
clickhouse:
  deploy: true
  httpPort: 8123
  nativePort: 9000
  auth:
    username: "default"
    existingSecret: langfuse-clickhouse-auth
    existingSecretKey: password
  replicaCount: 1
  shards: 1
  persistence:
    enabled: true
    # size: injected via parameters
    storageClass: ""  # Use default storage class
  resources:
    requests:
      memory: 1Gi
      cpu: 500m
    limits:
      memory: 2Gi
      cpu: 1000m
  migration:
    autoMigrate: true
    ssl: false

# Bundled Redis (deployed as part of the Helm release)
redis:
  deploy: true
  port: 6379
  tls:
    enabled: false
  auth:
    enabled: true
    existingSecret: langfuse-redis-auth
    existingSecretPasswordKey: password
  architecture: standalone
  master:
    persistence:
      enabled: true
      # size: injected via parameters
      storageClass: ""  # Use default storage class
    resources:
      requests:
        memory: 256Mi
        cpu: 100m
      limits:
        memory: 512Mi
        cpu: 250m

# Bundled MinIO (S3-compatible storage deployed as part of the Helm release)
s3:
  deploy: true
  bucket: langfuse
  region: "us-east-1"
  forcePathStyle: true
  accessKeyId:
    secretKeyRef:
      name: langfuse-minio-auth
      key: root-user
  secretAccessKey:
    secretKeyRef:
      name: langfuse-minio-auth
      key: root-password
  eventUpload:
    bucket: langfuse
    forcePathStyle: true
    accessKeyId:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-user
    secretAccessKey:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-password
  batchExport:
    enabled: true
    bucket: langfuse
    forcePathStyle: true
    accessKeyId:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-user
    secretAccessKey:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-password
  mediaUpload:
    enabled: true
    bucket: langfuse
    forcePathStyle: true
    accessKeyId:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-user
    secretAccessKey:
      secretKeyRef:
        name: langfuse-minio-auth
        key: root-password

# MinIO configuration
minio:
  enabled: true
  mode: standalone
  persistence:
    enabled: true
    # size: injected via parameters
    storageClass: ""  # Use default storage class
  resources:
    requests:
      memory: 512Mi
      cpu: 250m
    limits:
      memory: 1Gi
      cpu: 500m
  auth:
    existingSecret: langfuse-minio-auth
  defaultBuckets: "langfuse"
